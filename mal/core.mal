(def! _fn? (fn* [x]
  (if (fn? x)
    (if (get (meta x) "ismacro")
      false
      true)
    false)))

(def! macro? (fn* [x]
  (if (fn? x)
    (if (get (meta x) "ismacro")
      true
      false)
    false)))

(def! core_ns
  [["=" =]
   ["throw" throw]
   ["nil?" nil?]
   ["true?" true?]
   ["false?" false?]
   ["symbol" symbol]
   ["symbol?" symbol?]
   ["keyword" keyword]
   ["keyword?" keyword?]
   ["fn?" _fn?]
   ["macro?" macro?]

   ["pr-str" pr-str]
   ["str" str]
   ["prn" prn]
   ["println" println]
   ["readline" readline]
   ["read-string" read-string]
   ["slurp" slurp]
   ["<" <]
   ["<=" <=]
   [">" >]
   [">=" >=]
   ["+" +]
   ["-" -]
   ["*" *]
   ["/" /]

   ["list" list]
   ["list?" list?]
   ["vector" vector]
   ["vector?" vector?]
   ["hash-map" hash-map]
   ["map?" map?]
   ["assoc" assoc]
   ["dissoc" dissoc]
   ["get" get]
   ["contains?" contains?]
   ["keys" keys]
   ["vals" vals]

   ["sequential?" sequential?]
   ["cons" cons]
   ["concat" concat]
   ["nth" nth]
   ["first" first]
   ["rest" rest]
   ["empty?" empty?]
   ["count" count]
   ["apply" apply]
   ["map" map]

   ["with-meta" with-meta]
   ["meta" meta]
   ["atom" atom]
   ["atom?" atom?]
   ["deref" deref]
   ["reset!" reset!]
   ["swap!" swap!]])

; These functions are not required for self-hosting, so we only provide
; them if the outer implementation does so.
(defmacro! maybe-hoist (fn* (x)
  `(try* (def! core_ns (cons (vector ~(str x) ~x) core_ns)) (catch* _ nil))))

(maybe-hoist time-ms)
(maybe-hoist conj)
(maybe-hoist string?)
(maybe-hoist number?)
(maybe-hoist seq)
